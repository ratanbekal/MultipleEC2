#!groovy

pipeline {
    environment {
    instancecount = "${instance_count}"
  }
  
  step([$class: 'WsCleanup'])

  withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'fsig49-povuser', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]){
    
  stage ('Checkout') {
    git 'https://github.com/shruthiWadageri/MultipleEC2.git'
  }

  stage ('Terraform Plan') {
    
    bat 'terraform init'
    bat 'terraform plan -var instance_count="${env.instancecount}"'
  }


  stage ('Terraform Apply') {
    
    bat 'terraform apply -auto-approve'
  }

  }

}
