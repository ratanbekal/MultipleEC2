#!groovy

// Build Parameters
//properties([ parameters([
  //string( name: 'AWS_ACCESS_KEY_ID', defaultValue: ''),
  //string( name: 'AWS_SECRET_ACCESS_KEY', defaultValue: '')
//]), pipelineTriggers([]) ])

// Environment Variables
//env.AWS_ACCESS_KEY_ID = AWS_ACCESS_KEY_ID
//env.AWS_SECRET_ACCESS_KEY = AWS_SECRET_ACCESS_KEY

node {

  withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'fsig49-povuser', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]){
    
  stage ('Checkout') {
    git 'https://github.com/shruthiWadageri/MultipleEC2.git'
  }

  stage ('Terraform Plan') {
    
    bat 'terraform init'
    bat 'terraform plan'
  }


  stage ('Terraform Apply') {
    
    sh 'terraform apply -auto-approve'
  }

  }

  stage ('Notification') {
    mail from: "s.girish.wadageri@accenture.com",
         to: "s.girish.wadageri@accenture.com",
         subject: "Terraform build complete",
         body: "Jenkins job ${env.JOB_NAME} - build ${env.BUILD_NUMBER} complete"
  }
}
